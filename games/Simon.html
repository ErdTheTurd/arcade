<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Simon Pulse</title>
    <link rel="stylesheet" href="../assets/site.css" />
    <style>
      #pad {
        display: grid;
        grid-template-columns: repeat(2, 120px);
        gap: 16px;
      }
      .tone {
        width: 120px;
        height: 120px;
        border-radius: 18px;
        opacity: 0.8;
        border: 2px solid rgba(255, 255, 255, 0.1);
      }
      .tone.active {
        opacity: 1;
        box-shadow: 0 0 18px rgba(255, 255, 255, 0.4);
      }
    </style>
  </head>
  <body>
    <div class="wrapper fade-in">
      <a class="back-link" href="../index.html">Back to Hub</a>
      <div class="page-title">
        <h2>Simon Pulse</h2>
        <div class="controls">
          <button id="start">Start</button>
          <button id="reset">Reset</button>
        </div>
      </div>

      <div class="game-shell">
        <div class="game-panel">
          <div id="pad">
            <button class="tone" data-tone="0" style="background:#ff6a3d"></button>
            <button class="tone" data-tone="1" style="background:#00d4ff"></button>
            <button class="tone" data-tone="2" style="background:#ffd166"></button>
            <button class="tone" data-tone="3" style="background:#7f7eff"></button>
          </div>
        </div>
        <div class="game-panel">
          <strong>How to play</strong>
          <div class="note">Watch the sequence, then repeat it by clicking the pads.</div>
          <div class="note" id="status">Press start to begin.</div>
        </div>
      </div>
    </div>

    <script>
      const tones = Array.from(document.querySelectorAll(".tone"));
      const statusEl = document.getElementById("status");
      const startBtn = document.getElementById("start");
      const resetBtn = document.getElementById("reset");
      let sequence = [];
      let input = [];
      let accepting = false;

      function flash(index) {
        return new Promise((resolve) => {
          const tone = tones[index];
          tone.classList.add("active");
          setTimeout(() => {
            tone.classList.remove("active");
            setTimeout(resolve, 120);
          }, 400);
        });
      }

      async function playSequence() {
        accepting = false;
        statusEl.textContent = `Round ${sequence.length}`;
        for (const index of sequence) {
          await flash(index);
        }
        accepting = true;
        input = [];
      }

      function nextRound() {
        sequence.push(Math.floor(Math.random() * 4));
        playSequence();
      }

      tones.forEach((tone) => {
        tone.addEventListener("click", () => {
          if (!accepting) return;
          const index = Number(tone.dataset.tone);
          flash(index);
          input.push(index);
          const step = input.length - 1;
          if (input[step] !== sequence[step]) {
            statusEl.textContent = `Wrong move. Score: ${sequence.length - 1}`;
            accepting = false;
            return;
          }
          if (input.length === sequence.length) {
            nextRound();
          }
        });
      });

      startBtn.addEventListener("click", () => {
        if (sequence.length === 0) {
          nextRound();
        }
      });

      resetBtn.addEventListener("click", () => {
        sequence = [];
        input = [];
        accepting = false;
        statusEl.textContent = "Press start to begin.";
      });
    </script>
  </body>
</html>
