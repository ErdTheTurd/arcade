<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Snake</title>
    <link rel="stylesheet" href="../assets/site.css" />
    <style>
      #snake {
        width: 480px;
        height: 480px;
      }
    </style>
  </head>
  <body>
    <div class="wrapper fade-in">
      <a class="back-link" href="../index.html">Back to Hub</a>
      <div class="page-title">
        <h2>Snake</h2>
        <div class="controls">
          <button id="start">Start</button>
          <button id="reset">Reset</button>
        </div>
      </div>

      <div class="game-shell">
        <canvas id="snake" width="480" height="480"></canvas>
        <div class="game-panel">
          <strong>How to play</strong>
          <div class="note">Arrow keys steer the snake. Eat the pellets to grow.</div>
          <div class="note">Avoid walls and your own tail.</div>
          <div class="note" id="status">Score: 0</div>
        </div>
      </div>
    </div>

    <script>
      const canvas = document.getElementById("snake");
      const ctx = canvas.getContext("2d");
      const startBtn = document.getElementById("start");
      const resetBtn = document.getElementById("reset");
      const statusEl = document.getElementById("status");

      const size = 20;
      const cells = 24;
      let snake = [];
      let dir = { x: 1, y: 0 };
      let food = { x: 10, y: 10 };
      let running = false;
      let score = 0;
      let timer = null;

      function placeFood() {
        let spot;
        do {
          spot = {
            x: Math.floor(Math.random() * cells),
            y: Math.floor(Math.random() * cells),
          };
        } while (snake.some((s) => s.x === spot.x && s.y === spot.y));
        food = spot;
      }

      function resetGame() {
        snake = [
          { x: 10, y: 12 },
          { x: 9, y: 12 },
          { x: 8, y: 12 },
        ];
        dir = { x: 1, y: 0 };
        score = 0;
        placeFood();
        updateStatus();
      }

      function updateStatus(message) {
        statusEl.textContent = message ? message : `Score: ${score}`;
      }

      function step() {
        if (!running) return;
        const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
        if (head.x < 0 || head.y < 0 || head.x >= cells || head.y >= cells) {
          running = false;
          updateStatus("Crashed! Hit reset.");
          return;
        }
        if (snake.some((seg) => seg.x === head.x && seg.y === head.y)) {
          running = false;
          updateStatus("Tail bite! Hit reset.");
          return;
        }
        snake.unshift(head);
        if (head.x === food.x && head.y === food.y) {
          score += 10;
          placeFood();
        } else {
          snake.pop();
        }
        draw();
        updateStatus();
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#0b0f1f";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "#00d4ff";
        snake.forEach((seg, i) => {
          ctx.fillStyle = i === 0 ? "#ffd166" : "#00d4ff";
          ctx.fillRect(seg.x * size, seg.y * size, size - 2, size - 2);
        });

        ctx.fillStyle = "#ff6a3d";
        ctx.fillRect(food.x * size, food.y * size, size - 2, size - 2);
      }

      document.addEventListener("keydown", (event) => {
        if (event.key === "ArrowUp" && dir.y !== 1) dir = { x: 0, y: -1 };
        if (event.key === "ArrowDown" && dir.y !== -1) dir = { x: 0, y: 1 };
        if (event.key === "ArrowLeft" && dir.x !== 1) dir = { x: -1, y: 0 };
        if (event.key === "ArrowRight" && dir.x !== -1) dir = { x: 1, y: 0 };
      });

      startBtn.addEventListener("click", () => {
        if (!running) {
          running = true;
          clearInterval(timer);
          timer = setInterval(step, 120);
        }
      });

      resetBtn.addEventListener("click", () => {
        running = false;
        resetGame();
        draw();
      });

      resetGame();
      draw();
    </script>
  </body>
</html>
