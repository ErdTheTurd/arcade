<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Asteroids</title>
    <link rel="stylesheet" href="../assets/site.css" />
    <style>
      #asteroids {
        width: 640px;
        height: 420px;
      }
    </style>
  </head>
  <body>
    <div class="wrapper fade-in">
      <a class="back-link" href="../index.html">Back to Hub</a>
      <div class="page-title">
        <h2>Asteroids</h2>
        <div class="controls">
          <button id="start">Start</button>
          <button id="reset">Reset</button>
        </div>
      </div>

      <div class="game-shell">
        <canvas id="asteroids" width="640" height="420"></canvas>
        <div class="game-panel">
          <strong>How to play</strong>
          <div class="note">Arrow keys move. Space shoots.</div>
          <div class="note" id="status">Score: 0</div>
        </div>
      </div>
    </div>

    <script>
      const canvas = document.getElementById("asteroids");
      const ctx = canvas.getContext("2d");
      const startBtn = document.getElementById("start");
      const resetBtn = document.getElementById("reset");
      const statusEl = document.getElementById("status");

      let ship = { x: 320, y: 210, vx: 0, vy: 0, r: 12 };
      let asteroids = [];
      let shots = [];
      let running = false;
      let score = 0;
      let keys = {};

      function resetGame() {
        ship = { x: 320, y: 210, vx: 0, vy: 0, r: 12 };
        asteroids = Array.from({ length: 6 }, () => ({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          r: 16 + Math.random() * 18,
          vx: -1 + Math.random() * 2,
          vy: -1 + Math.random() * 2,
        }));
        shots = [];
        score = 0;
        updateStatus();
        draw();
      }

      function updateStatus(message) {
        statusEl.textContent = message || `Score: ${score}`;
      }

      function shoot() {
        if (!running) return;
        shots.push({ x: ship.x, y: ship.y, vx: ship.vx * 2 + 4, vy: ship.vy * 2 });
      }

      function step() {
        if (!running) return;

        if (keys.ArrowUp) ship.vy -= 0.2;
        if (keys.ArrowDown) ship.vy += 0.2;
        if (keys.ArrowLeft) ship.vx -= 0.2;
        if (keys.ArrowRight) ship.vx += 0.2;

        ship.x = (ship.x + ship.vx + canvas.width) % canvas.width;
        ship.y = (ship.y + ship.vy + canvas.height) % canvas.height;

        asteroids.forEach((a) => {
          a.x = (a.x + a.vx + canvas.width) % canvas.width;
          a.y = (a.y + a.vy + canvas.height) % canvas.height;
        });

        shots.forEach((s) => {
          s.x += s.vx;
          s.y += s.vy;
        });
        shots = shots.filter((s) => s.x > -20 && s.x < canvas.width + 20 && s.y > -20 && s.y < canvas.height + 20);

        shots.forEach((s) => {
          asteroids.forEach((a) => {
            const dx = s.x - a.x;
            const dy = s.y - a.y;
            if (Math.hypot(dx, dy) < a.r) {
              a.r = 0;
              s.x = -999;
              score += 10;
            }
          });
        });
        asteroids = asteroids.filter((a) => a.r > 0);

        for (const a of asteroids) {
          if (Math.hypot(ship.x - a.x, ship.y - a.y) < ship.r + a.r) {
            running = false;
            updateStatus("Ship hit. Reset?");
          }
        }

        if (asteroids.length === 0) {
          running = false;
          updateStatus("All clear!");
        }

        draw();
        updateStatus();
        requestAnimationFrame(step);
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#0b0f1f";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.strokeStyle = "#00d4ff";
        ctx.beginPath();
        ctx.arc(ship.x, ship.y, ship.r, 0, Math.PI * 2);
        ctx.stroke();

        ctx.fillStyle = "#ff6a3d";
        asteroids.forEach((a) => {
          ctx.beginPath();
          ctx.arc(a.x, a.y, a.r, 0, Math.PI * 2);
          ctx.fill();
        });

        ctx.fillStyle = "#ffd166";
        shots.forEach((s) => ctx.fillRect(s.x - 2, s.y - 2, 4, 4));
      }

      document.addEventListener("keydown", (event) => {
        keys[event.key] = true;
        if (event.key === " ") shoot();
      });
      document.addEventListener("keyup", (event) => {
        keys[event.key] = false;
      });

      startBtn.addEventListener("click", () => {
        if (!running) {
          running = true;
          requestAnimationFrame(step);
        }
      });

      resetBtn.addEventListener("click", () => {
        running = false;
        resetGame();
      });

      resetGame();
    </script>
  </body>
</html>
